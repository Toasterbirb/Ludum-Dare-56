#include "BoxCollider.hpp"
#include "GameScenes.hpp"
#include "Info.hpp"
#include "Level2.hpp"
#include "Model.hpp"
#include "Transform.hpp"

namespace ld
{
	level2::level2(birb::renderer& renderer, birb::window& window, birb::camera& camera, birb::timestep& timestep, birb::audio_player& audio_player)
	:level_state(renderer, window, camera, timestep, audio_player)
	{}

	void level2::awake()
	{
		blobs.resize(3);
		level_state::awake();

		floor_layout = {
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,1,0,1,0,0,0,
			0,0,0,0,1,1,1,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
		};

		goal_locations = {
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,1,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
			0,0,0,0,0,0,0,0,0,0,
		};

		load_level();

		birb::model m_tutorial("./assets/level2.obj");
		tutorial.add_component(m_tutorial);
		tutorial.add_component(birb::info("Tutorial"));
		tutorial.get_component<birb::transform>().position = { 2.8, 0.25, 3 };
		tutorial.get_component<birb::transform>().rotation = { 0, 180, 0 };
	}

	void level2::start()
	{
		level_state::start();

		// avoid cursor jumps by polling input before setting camera position
		// and rotation
		camera.process_input(window, timestep);

		camera.position = { -4.49019, 4.56978, 3.54651 };
		camera.pitch = -32.9;
		camera.yaw = 15.8;
	}

	void level2::input(birb::input& input)
	{
		level_state::input(input);

		if (input.state == birb::input::action::key_down)
		{
			switch (input.key)
			{
				default:
					break;
			}
		}
	}

	void level2::update()
	{
		level_state::update();
		blob_tick();
	}

	void level2::render()
	{
		level_state::render();

	}

	game_scene level2::end()
	{
		return game_scene::level3;
	}
}
